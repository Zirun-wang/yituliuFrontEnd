<template>
  <div id="gacha">
    <el-collapse v-model="checkBox" @change="handleChange">
      <!-- 总计 -->
      <el-collapse-item style="display: block; position: sticky; top: 60px;z-index: 99999999;" name="0" id="totalTable">
        <template slot="title">
          <div class="gacha_title_icon" style="background: chocolate"></div>
          <span class="collapse-item_title" style="color: purple">
            共计{{ toFixedByAcc(gachaTimes_total, 0) }}抽，氪金{{ sellsCount }}元
          </span>
          <span style="font-size: 20px;color: rgb(136 136 136 / 69%);margin-left: 16px;">yituliu.site</span>
        </template>
        <!-- <el-divider></el-divider> -->
        <div class="gacha_unit" id="total">
          <!-- 如果有4个选项则修改为 style="width:98%;margin:0 1%;"，子项宽度25% -->
         
           <el-radio-group size="small" style="width: 90%; margin: 6px 5%" v-model="timeSelector"  @change="checkEndDate(timeSelector)">
            <el-radio-button label="怪猎联动(3.21)" style="width: 33%"
            ></el-radio-button>
            <el-radio-button label="4周年(5.15)" style="width: 33%"
            ></el-radio-button>
            <el-radio-button label="夏活限定" type="primary" style="width: 33%" disabled
            ></el-radio-button>
            <!-- <el-radio-button label="????" disabled style="width:32%;"></el-radio-button> -->
          </el-radio-group>
          <!-- <el-divider></el-divider> -->
          <div id="gacha_total_chart">
            <div id="gacha_total_pie" ref="gacha_total_pie"
                 style="vertical-align: top; height: 200px; width: 300px; display: inline-block; top: 10px;"></div>
            <table id="gacha_total_table">
              <tbody>
              <tr class="gacha_total_table_tr">
                <td>现有</td>
                <td>{{ toFixedByAcc(calResults.gachaTimes_exist, 0) }}</td>
                <td>抽</td>
              </tr>
              <tr class="gacha_total_table_tr">
                <td>日常</td>
                <td>{{ toFixedByAcc(calResults.gachaTimes_daily, 0) }}</td>
                <td>抽</td>
              </tr>
              <tr class="gacha_total_table_tr">
                <td>潜在</td>
                <td>{{ toFixedByAcc(calResults.gachaTimes_potential, 0) }}</td>
                <td>抽</td>
              </tr>
              <tr class="gacha_total_table_tr">
                <td>氪金</td>
                <td>{{ toFixedByAcc(calResults.gachaTimes_gacha, 0) }}</td>
                <td>抽</td>
              </tr>
              <tr class="gacha_total_table_tr">
                <td>活动(估算)</td>
                <td>{{ toFixedByAcc(calResults.gachaTimes_act, 0) }}</td>
                <td>抽</td>
              </tr>
              <tr class="gacha_total_table_tr">
                <td>其它(估算)</td>
                <td>{{ toFixedByAcc(calResults.gachaTimes_other, 0) }}</td>
                <td>抽</td>
              </tr>
              </tbody>
            </table>
          </div>

          <el-divider></el-divider>
          <div class="gacha_unit_child" style="display: flex">
            <div class="gacha_unit_child_title">
              <div style="display: flex">
                <div :class="getSpriteImg('4003icon', 0)"></div>
                {{ toFixedByAcc(orundum, 0) }}
                <span style="font-size: 14px;">
                 &nbsp;({{ (toFixedByAcc(orundum, 0) / 600).toFixed(2) }})
                </span>
              </div>
            </div>
            <div class="gacha_unit_child_title">
              <div style="display: flex">
                <div :class="getSpriteImg('4002icon', 0)"></div>
                {{ toFixedByAcc(originium, 0) }}
                <span style="font-size: 14px;">
                 &nbsp;({{ (gachaTimes_originium).toFixed(2) }})
                </span>
              </div>
            </div>
            <div class="gacha_unit_child_title">
              <div style="display: flex">
                <div :class="getSpriteImg('7003icon', 0)"></div>
                {{ toFixedByAcc(permit, 0) }}
              </div>
            </div>
            <div class="gacha_unit_child_title">
              <div style="display: flex">
                <div :class="getSpriteImg('7004icon', 0)"></div>
                {{ toFixedByAcc(permit10, 0) }}
                <span style="font-size: 14px;">
                 &nbsp;({{ toFixedByAcc(permit10, 0) * 10 }})
                </span>
              </div>
            </div>
          </div>
        </div>
      </el-collapse-item>
      <!-- 现有库存 -->
      <el-collapse-item name="1" style="display: block">
        <template slot="title">
          <div class="gacha_title_icon"></div>
          <span class="collapse-item_title"
          >现有库存 {{ toFixedByAcc(calResults.gachaTimes_exist, 0) }}抽</span
          >
        </template>
        <!-- 内容区 -->
        <div class="gacha_unit" id="wallet">
          <!-- 现有资源 -->
          <div class="gacha_unit_child" style="display: flex">
            <div class="gacha_unit_child_title">
              <div style="display: flex">
                <div :class="getSpriteImg('4003icon', 0)"></div>
                <input
                  type="text"
                  @change="compute()"
                  class="gacha_unit_child_inputbox"
                  v-model.number="calResults.orundum_exist" 
                  oninput="value=value.replace(/[^\d]/g, '')"
                />
              </div>
            </div>
            <div class="gacha_unit_child_title">
              <div style="display: flex">
                <div :class="getSpriteImg('4002icon', 0)"></div>
                <input
                  type="text"
                  @change="compute()"
                  class="gacha_unit_child_inputbox"
                  v-model.number="calResults.originium_exist"
                  oninput="value=value.replace(/[^\d]/g, '')"
                />
              </div>
            </div>
            <div class="gacha_unit_child_title">
              <div style="display: flex">
                <div :class="getSpriteImg('7003icon', 0)"></div>
                <input
                  type="text"
                  @change="compute()"
                  class="gacha_unit_child_inputbox"
                  v-model.number="calResults.permit_exist"
                  oninput="value=value.replace(/[^\d]/g, '')"
                />
              </div>
            </div>
            <div class="gacha_unit_child_title">
              <div style="display: flex">
                <div :class="getSpriteImg('7004icon', 0)"></div>
                <input
                  type="text"
                  @change="compute()"
                  class="gacha_unit_child_inputbox"
                  v-model.number="calResults.permit10_exist"
                  oninput="value=value.replace(/[^\d]/g, '')"
                />
              </div>
            </div>
          </div>
          <!-- 源石是否抽卡 -->
          <div class="gacha_unit_child" style="display: flex">
            <div @click="compute()">
              <el-switch
                v-model="originiumFlag"
                active-color="#13ce66"
                inactive-color="#ff4949"></el-switch>
              源石是否用于抽卡
            </div>
          </div>
          <el-divider></el-divider>
          <!-- 自定义修正值 -->
          <div class="gacha_unit_child">
            <input
              class="gacha_unit_child_inputbox"
              type="text"
              @change="compute()"
              v-model.number="customValue"
              oninput="value=value.replace(/[^\d]/g, '')"
            />
            <div class="gacha_unit_child_title" style="width: 330px;">
              自定义修正值(合成玉)
            </div>
            <div class="gacha_resources_unit" style="width: 135px;">
              <div :class="getSpriteImg('4003icon', 0)"></div>
              {{ customValue }}
            </div>
          </div>
          <div class="gacha_unit_info">
            例如给轮换池预留、其它来源等，可填负数
          </div>
          <!-- <div class="gacha_unit_child">
            <div class="gacha_unit_child_title" style="width: 100%;">
              搓玉比例:1理智=1.09玉(1-7)
              <a href="/?item=Orundum" style="margin: 0px 20px;">查看备选搓玉关卡</a>
              <a href="https://www.bilibili.com/video/BV1XT411F7m4" style="display: inline-block;">
                如何安排搓玉？
                <img class="gacha_img_small" src="/img/website/el.png"/>
              </a>
            </div>
          </div> -->
          <!-- 预留皮肤 -->
          <div class="gacha_unit_child" style="display: flex">
            <div class="gacha_unit_child_title">
              预留皮肤(18石/件)
            </div>
            <el-slider
              v-model="skinNumValue"
              :step="1"
              :min="0"
              :max="10"
              show-stops
              show-input

              @change="compute()"
              style="display: inline-block; flex-grow: 1"
            >
            </el-slider>
          </div>
          <!-- 搓玉计算 -->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png"/>
            搓玉计算
          </div>
          <div class="gacha_unit_child">
            <input
              class="gacha_unit_child_inputbox"
              type="text"
              @change="compute()"
              v-model.number="orundum_ap"
              
            />
            用于搓玉的理智 X
            <input
              class="gacha_unit_child_inputbox"
              type="text"
              @change="compute()"
              v-model.number="orundum_rate" 
              oninput="value=value.replace(/[^0-9.]+/g, '')"
              style="width: 45px;"
            />
            搓玉系数 =
            <div class="gacha_resources_unit">
              <div :class="getSpriteImg('4003icon', 0)"></div>
              {{ toFixedByAcc(orundum_ap * orundum_rate, 2) }}
            </div>
          </div>
          <div class="gacha_unit_info">
            搓玉系数：1-7(1.09)
          </div>
          <div class="gacha_unit_child">
            <a href="/?item=Orundum" style="margin: 0px 24px 0px 0px;">查看其它可搓玉关卡</a>
            <a href="https://www.bilibili.com/video/BV1XT411F7m4" style="display: inline-block;"> 搓玉教程<img
              class="gacha_img_small" src="/img/website/el.png"/></a>
          </div>
        </div>
      </el-collapse-item>
      <!-- 日常积累 -->
      <el-collapse-item class="collapse-item" name="2" style="display: block">
        <template slot="title">
          <div class="gacha_title_icon"></div>
          <span class="collapse-item_title">日常积累 {{ toFixedByAcc(calResults.gachaTimes_daily, 0) }}抽</span>
        </template>
        <div class="gacha_unit" id="daily">
          <div class="gacha_unit_child">
            <div class="gacha_unit_child_title" style="width: 150px">
              日常 {{ remainingDays }} 天
            </div>
            <div class="gacha_resources_unit" style="width: 174px">
              <div :class="getSpriteImg('4003icon', 0)"></div>
              <div style="width: 75px">{{ dailyRewards }}</div>
            </div>
          </div>
          <!-- 日常周常分界线 -->
          <el-divider></el-divider>

          <div class="gacha_unit_child">
            <div class="gacha_unit_child_title" style="width: 150px">
              周常 {{ remainingWeeks + weeklyTaskValue }} 周
            </div>
            <div class="gacha_resources_unit" style="width: 192px">
              <div :class="getSpriteImg('4003icon', 0)"></div>
              <div style="width: 75px">
                {{ weeklyTaskRewards + weeklyTaskValue * 500 }}
              </div>
            </div>
            <div
              @click="compute()"
              class="gacha_unit_child_title"
              style="width: 150px; line-height: 32px"
            >
              <el-switch
                v-model="weeklyTaskFlag"
                active-color="#13ce66"
                inactive-color="#ff4949"></el-switch>
              本周已完成
            </div>
          </div>

          <div class="gacha_unit_child">
            <div class="gacha_unit_child_title" style="width: 150px">
              剿灭 {{ remainingWeeks + annihilationValue }} 周
            </div>
            <div class="gacha_resources_unit" style="width: 192px">
              <div :class="getSpriteImg('4003icon', 0)"></div>
              <div style="width: 75px">
                {{ annihilationRewards + annihilationValue * 1800 }}
              </div>
            </div>
            <div
              @click="compute()"
              class="gacha_unit_child_title"
              style="width: 150px; line-height: 32px"
            >
              <el-switch
                v-model="annihilationFlag"
                active-color="#13ce66"
                inactive-color="#ff4949"></el-switch>
              本周已完成
            </div>
          </div>
          <!-- 周常月常分界线 -->
          <el-divider></el-divider>
          <div class="gacha_unit_child">
            <div class="gacha_unit_child_title" style="width: 150px">
              绿票商店 {{ remainingMonths - storeValue }} 月
            </div>
            <div class="gacha_resources_unit" style="width: 192px">
              <div
                style="width: 40px"
                :class="getSpriteImg('4003icon', 0)"></div>
              <div style="width: 66px">
                {{ (remainingMonths - storeValue) * 600 }}
              </div>
              <div
                style="width: 40px"
                :class="getSpriteImg('7003icon', 0)"></div>
              <div style="width: 28px">
                {{ (remainingMonths - storeValue) * 4 }}
              </div>
            </div>
            <div
              @click="compute()"
              class="gacha_unit_child_title"
              style="width: 150px; line-height: 32px"
            >
              <el-switch
                v-model="storeFlag"
                active-color="#13ce66"
                inactive-color="#ff4949"></el-switch>
              本月已换
            </div>
          </div>
          <div class="gacha_unit_child">
            <div class="gacha_unit_child_title" style="width: 150px">
              每月签到 {{ remainingCheckinTimes }} 月
            </div>
            <div class="gacha_resources_unit" style="width: 174px">
              <div :class="getSpriteImg('7003icon', 0)"></div>
              <div style="width: 32px">{{ remainingCheckinTimes }}</div>
            </div>
          </div>
          <!-- 258分界线 -->
          <el-divider></el-divider>
          <el-checkbox-group v-model="gacha_store258List" class="">
            <div
              v-for="(singlePack, index) in gacha_store258"
              :key="index"
              v-show="singlePack.packType == 'store'"
              class="gacha_unit_child"
              @change="compute(singlePack.packName)"
            >
              <el-checkbox-button :label="index">
                <div class="gacha_unit_child_title" style="width: 150px">
                  {{ singlePack.packName }}
                </div>
                <div class="gacha_resources_unit">
                  <div
                    style="width: 40px"
                    :class="getSpriteImg('7004icon', 0)"
                  ></div>
                  <div style="width: 32px">{{ singlePack.gachaPermit10 }}</div>
                  <div
                    style="width: 40px"
                    :class="getSpriteImg('7003icon', 0)"
                  ></div>
                  <div style="width: 32px">{{ singlePack.gachaPermit }}</div>
                </div>
              </el-checkbox-button>
            </div>
          </el-checkbox-group>
        </div>
      </el-collapse-item>
      <!-- 潜在资源 -->
      <el-collapse-item class="collapse-item" name="3" style="display: block">
        <template slot="title">
          <div class="gacha_title_icon"></div>
          <span class="collapse-item_title"
          >潜在资源 {{ toFixedByAcc(calResults.gachaTimes_potential, 0) }}抽</span
          >
        </template>

        <div class="gacha_unit" id="potential">
          <!-- 悖论模拟 剿灭战模拟-->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png"/>
            悖论模拟/剿灭战模拟
          </div>
          <div class="gacha_unit_child">
            <input
              class="gacha_unit_child_inputbox"
              type="text"
              @change="compute()"
              v-model.number="paradox"
              oninput="value=value.replace(/[^\d]/g, '')"
            />
            <div class="gacha_unit_child_title" style="width: 120px">
              个悖论模拟
            </div>
            <div class="gacha_resources_unit" style="width: 105px">
              <div :class="getSpriteImg('4003icon', 0)"></div>
              {{ paradox * 200 }}
            </div>
          </div>
          <!-- 剿灭战模拟 -->
          <div class="gacha_unit_child">
            <input
              class="gacha_unit_child_inputbox"
              type="text"
              @change="compute()"
              v-model.number="annihilation"
              oninput="value=value.replace(/[^\d]/g, '')"
            />
            <div class="gacha_unit_child_title" style="width: 120px">
              个剿灭战模拟
            </div>
            <div class="gacha_resources_unit" style="width: 105px">
              <div :class="getSpriteImg('4003icon', 0)"></div>
              {{ annihilation * 1500 }}
            </div>
          </div>
          <div class="gacha_unit_info">
            剿灭战模拟并非常驻，可前往prts.wiki查看开放历史
            <a href="https://prts.wiki/w/%E5%85%B3%E5%8D%A1%E4%B8%80%E8%A7%88/%E5%B8%B8%E6%80%81%E4%BA%8B%E5%8A%A1"
               style="display: inline-block;">
              点我跳转<img class="gacha_img_small" src="/img/website/el.png"/>
            </a>
          </div>
          <!-- 主线 -->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png"/>
            主线、突袭、绝境
          </div>
          <el-checkbox-group v-model="gacha_potentialList" class="">
            <div
              v-for="(singlePack, index) in gacha_potential"
              :key="index"
              v-show="singlePack.packType == 'main'"
              class="gacha_unit_child"
              style="display: inline-block"
              @change="compute(singlePack.packName)"
            >
              <el-checkbox-button :label="index" size="small">
                <div
                  class="gacha_unit_child_title"
                  :style="getChapterWidth(index)"
                  style="padding-left: 4px"
                >
                  {{ singlePack.packName }}
                </div>
                <div class="gacha_resources_unit">
                  <div :class="getSpriteImg('4002icon', 0)"></div>
                  <div style="width: 36px">{{ singlePack.gachaOriginium }}</div>
                </div>
              </el-checkbox-button>
            </div>
          </el-checkbox-group>
          <!-- Sidestory -->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png"/>支线、别传
          </div>
          <el-checkbox-group v-model="gacha_potentialList" class="">
            <div
              v-for="(singlePack, index) in gacha_potential"
              :key="index"
              v-show="singlePack.packType == 'activity'"
              class="gacha_unit_child"
              style="display: inline-block"
              @change="compute(singlePack.packName)"
            >
              <el-checkbox-button :label="index" size="small">
                <div class="gacha_unit_child_title" style="width: 144px">
                  {{ singlePack.packName }}
                </div>
                <div class="gacha_resources_unit">
                  <div :class="getSpriteImg('4002icon', 0)"></div>
                  <div style="width: 36px">{{ singlePack.gachaOriginium }}</div>
                </div>
              </el-checkbox-button>
            </div>
          </el-checkbox-group>
        </div>
      </el-collapse-item>
      <!-- 氪金资源 -->
      <el-collapse-item class="collapse-item" name="4" style="display: block">
        <template slot="title">
          <div class="gacha_title_icon"></div>
          <span class="collapse-item_title">氪金资源 {{ toFixedByAcc(calResults.gachaTimes_gacha, 0) }}抽</span>
        </template>

        <div class="gacha_unit" id="charge">
          <div class="gacha_unit_child_instruction" style="padding: 4px 16px;font-size: 18px;color: brown;">
            标签内为每抽价格(元)，颜色用于区分性价比<br>
            仅计入礼包内抽卡资源，紫色高于648，橙色高于大月卡<br>
            <a href="https://yituliu.site/pack">点击跳转礼包完整性价比</a>
          </div>
          <!-- 月常礼包 -->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png">月常礼包
          </div>
          <el-checkbox-group v-model="gacha_storePacksList">
            <div v-for="(singlePack, index) in gacha_storePacks" :key="index" v-show="singlePack.packType == 'monthly'&&
            singlePack.packRmbPerDraw>0"
                 class="gacha_unit_child" @change="compute(singlePack.packName)">
              <el-checkbox-button :label="index">
                <div class="gacha_packPpr" :class=getPprLabel(singlePack.packRmbPerDraw)>
                  {{ toFixedByAcc(singlePack.packRmbPerDraw, 2) }}
                </div>
                <div class="gacha_unit_child_title" style="width: 168px">
                  {{ singlePack.packName }}
                </div>
                <div class="gacha_resources_unit" style="width: 192px">
                  <div style="width: 40px" v-show="singlePack.gachaOrundum !== 0"
                       :class="getSpriteImg('4003icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaOrundum !== 0">{{ singlePack.gachaOrundum }}</div>
                  <div style="width: 40px" v-show="singlePack.gachaOriginium !== 0"
                       :class="getSpriteImg('4002icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaOriginium !== 0"> {{
                      singlePack.gachaOriginium
                    }}
                  </div>
                  <div style="width: 40px" v-show="singlePack.gachaPermit !== 0"
                       :class="getSpriteImg('7003icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaPermit !== 0"> {{ singlePack.gachaPermit }}</div>
                  <div style="width: 40px" v-show="singlePack.gachaPermit10 !== 0"
                       :class="getSpriteImg('7004icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaPermit10 !== 0"> {{ singlePack.gachaPermit10 }}</div>
                </div>
              </el-checkbox-button>
            </div>
          </el-checkbox-group>
          <!-- 限时礼包 -->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png">限时礼包
          </div>
          <el-checkbox-group v-model="gacha_storePacksList" class="">
            <div v-for="(singlePack, index) in gacha_storePacks" :key="index"
                 v-show="singlePack.packType == 'limited'&&1==singlePack.packState&&singlePack.packRmbPerDraw>0"
                 class="gacha_unit_child" @change="compute(singlePack.packName)">
              <el-checkbox-button :label="index">
                <div class="gacha_packPpr" :class=getPprLabel(singlePack.packRmbPerDraw)>
                  {{ toFixedByAcc(singlePack.packRmbPerDraw, 2) }}
                </div>
                <div class="gacha_unit_child_title" style="width: 168px">
                  {{ singlePack.packName }}
                </div>
                <!-- 一个通用的资源显示模块 -->
                <div class="gacha_resources_unit" style="width: 279px;">
                  <div style="width: 40px" v-show="singlePack.gachaOrundum > 0.1"
                       :class="getSpriteImg('4003icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaOrundum > 0.1">{{ singlePack.gachaOrundum }}</div>
                  <div style="width: 40px" v-show="singlePack.gachaOriginium > 0.1"
                       :class="getSpriteImg('4002icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaOriginium > 0.1"> {{
                      singlePack.gachaOriginium
                    }}
                  </div>
                  <div style="width: 40px" v-show="singlePack.gachaPermit > 0.1"
                       :class="getSpriteImg('7003icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaPermit > 0.1"> {{ singlePack.gachaPermit }}</div>
                  <div style="width: 40px" v-show="singlePack.gachaPermit10 > 0.1"
                       :class="getSpriteImg('7004icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaPermit10 > 0.1"> {{ singlePack.gachaPermit10 }}</div>
                </div>
              </el-checkbox-button>
            </div>
          </el-checkbox-group>
          <!-- 新人礼包 -->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png">新人礼包
          </div>
          <el-checkbox-group v-model="gacha_storePacksList" class="">
            <div v-for="(singlePack, index) in gacha_storePacks" :key="index" v-show="singlePack.packType == 'once'"
                 class="gacha_unit_child" @change="compute(singlePack.packName)">
              <el-checkbox-button :label="index">
                <div class="gacha_packPpr" :class=getPprLabel(singlePack.packRmbPerDraw)>
                  {{ toFixedByAcc(singlePack.packRmbPerDraw, 2) }}
                </div>
                <div class="gacha_unit_child_title" style="width: 168px">
                  {{ singlePack.packName }}
                </div>
                <!-- 一个通用的资源显示模块 -->
                <div class="gacha_resources_unit" style="width: 279px;">
                  <div style="width: 40px" v-show="singlePack.gachaOrundum > 0.1"
                       :class="getSpriteImg('4003icon', 0)"/>
                  <div style="width: 54px" v-show="singlePack.gachaOrundum > 0.1">{{ singlePack.gachaOrundum }}</div>
                  <div style="width: 40px" v-show="singlePack.gachaOriginium > 0.1"
                       :class="getSpriteImg('4002icon', 0)"/>
                  <div style="width: 54px" v-show="singlePack.gachaOriginium > 0.1"> {{
                      singlePack.gachaOriginium
                    }}
                  </div>
                  <div style="width: 40px" v-show="singlePack.gachaPermit > 0.1"
                       :class="getSpriteImg('7003icon', 0)"/>
                  <div style="width: 54px" v-show="singlePack.gachaPermit > 0.1"> {{ singlePack.gachaPermit }}</div>
                  <div style="width: 40px" v-show="singlePack.gachaPermit10 > 0.1"
                       :class="getSpriteImg('7004icon', 0)"/>
                  <div style="width: 54px" v-show="singlePack.gachaPermit10 > 0.1"> {{ singlePack.gachaPermit10 }}</div>
                </div>
              </el-checkbox-button>
            </div>
          </el-checkbox-group>
          <!-- 首充 -->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png"/>源石首充
          </div>
          <el-checkbox-group v-model="gacha_storePacksList" class="">
            <div v-for="(singlePack, index) in gacha_storePacks" :key="index" v-show="singlePack.packType == 'year'"
                 class="gacha_unit_child" @change="compute(singlePack.packName)">
              <el-checkbox-button :label="index">
                <div class="gacha_packPpr" :class=getPprLabel(singlePack.packRmbPerDraw)>
                  {{ toFixedByAcc(singlePack.packRmbPerDraw, 2) }}
                </div>
                <div class="gacha_unit_child_title" style="width: 168px">
                  {{ singlePack.packName }}
                </div>
                <div class="gacha_resources_unit" style="width: 102px">
                  <div style="width: 40px" v-show="singlePack.gachaOriginium !== 0"
                       :class="getSpriteImg('4002icon', 0)"></div>
                  <div style="width: 54px" v-show="singlePack.gachaOriginium !== 0">{{ singlePack.gachaOriginium }}
                  </div>
                </div>
              </el-checkbox-button>
            </div>
          </el-checkbox-group>
          <!-- 非首充 -->
          <div class="gacha_unit_fold">
            <img class="gacha_img_small" src="/img/website/ex-icon.png"/>非首充
          </div>

          <div class="gacha_unit_child">
            <input class="gacha_unit_child_inputbox" type="text" @change="compute()" v-model.number="originium_648">
            <div class="gacha_packPpr" :class=getPprLabel(11.68)>11.68</div>
            <div class="gacha_unit_child_title" style="width: 225px">
              普通源石648元
            </div>
            <div class="gacha_resources_unit" style="width: 126px">
              <div
                style="width: 40px"
                :class="getSpriteImg('4002icon', 0)"></div>
              <div style="width: 54px">{{ toFixedByAcc(originium_648 * 185, 0) }}</div>
            </div>
          </div>
          <div class="gacha_unit_child">
            <input class="gacha_unit_child_inputbox" type="text" @change="compute()" v-model.number="originium_328">
            <div class="gacha_packPpr" :class=getPprLabel(12.15)>12.15</div>
            <div class="gacha_unit_child_title" style="width: 225px">
              普通源石328元
            </div>
            <div class="gacha_resources_unit" style="width: 126px">
              <div
                style="width: 40px"
                :class="getSpriteImg('4002icon', 0)"></div>
              <div style="width: 54px">{{ toFixedByAcc(originium_328 * 90, 0) }}</div>
            </div>
          </div>
          <div class="gacha_unit_child">
            <input class="gacha_unit_child_inputbox" type="text" @change="compute()" v-model.number="originium_198">
            <div class="gacha_packPpr" :class=getPprLabel(13.20)>13.20</div>
            <div class="gacha_unit_child_title" style="width: 225px">
              普通源石198元
            </div>
            <div class="gacha_resources_unit" style="width: 126px">
              <div
                style="width: 40px"
                :class="getSpriteImg('4002icon', 0)"></div>
              <div style="width: 54px">{{ toFixedByAcc(originium_198 * 50, 0) }}</div>
            </div>
          </div>
          <div class="gacha_unit_child">
            <input class="gacha_unit_child_inputbox" type="text" @change="compute()" v-model.number="originium_98">
            <div class="gacha_packPpr" :class=getPprLabel(13.61)>13.61</div>
            <div class="gacha_unit_child_title" style="width: 225px">
              普通源石98元
            </div>
            <div class="gacha_resources_unit" style="width: 126px">
              <div
                style="width: 40px"
                :class="getSpriteImg('4002icon', 0)"></div>
              <div style="width: 54px">{{ toFixedByAcc(originium_98 * 24, 0) }}</div>
            </div>
          </div>
          <div class="gacha_unit_child">
            <input class="gacha_unit_child_inputbox" type="text" @change="compute()" v-model.number="originium_30">
            <div class="gacha_packPpr" :class=getPprLabel(14.29)>14.29</div>
            <div class="gacha_unit_child_title" style="width: 225px">
              普通源石30元
            </div>
            <div class="gacha_resources_unit" style="width: 126px">
              <div
                style="width: 40px"
                :class="getSpriteImg('4002icon', 0)"></div>
              <div style="width: 54px">{{ toFixedByAcc(originium_30 * 7, 0) }}</div>
            </div>
          </div>
          <div class="gacha_unit_child">
            <input class="gacha_unit_child_inputbox" type="text" @change="compute()" v-model.number="originium_6">
            <div class="gacha_packPpr" :class=getPprLabel(20.00)>20.00</div>
            <div class="gacha_unit_child_title" style="width: 225px">
              普通源石6元
            </div>
            <div class="gacha_resources_unit" style="width: 126px">
              <div
                style="width: 40px"
                :class="getSpriteImg('4002icon', 0)"></div>
              <div style="width: 54px">{{ toFixedByAcc(originium_6 * 1, 0) }}</div>
            </div>
          </div>

          <!-- 复选模块End -->
        </div>
      </el-collapse-item>
      <!-- 活动获得（估算） -->
      <el-collapse-item class="collapse-item" name="5" style="display: block">
        <template slot="title">
          <div class="gacha_title_icon"></div>
          <span class="collapse-item_title">活动获得（估算）{{ toFixedByAcc(calResults.gachaTimes_act, 0) }}抽</span>
        </template>

        <div class="gacha_unit" id="activity">

          <div class="gacha_unit_child">复刻活动</div>
          <el-checkbox-group v-model="gacha_actReList" class="">
            <div
              v-for="(actRe, key) in gacha_honeyCake"
              :key="key"

              class="gacha_unit_child"
              @change="compute(key)"
            >
              <el-checkbox-button :label="key" v-show="isDuringDate(actRe.start,actRe.end)&&'actRe'==actRe.module">
                <div class="gacha_unit_child_title" style="width: 200px">
                  {{ key }}
                </div>
                <div class="gacha_resources_unit" style="width: 192px">
                  <div style="width: 40px" v-show="actRe.orundum !== 0" :class="getSpriteImg('4003icon', 0)"
                  ></div>
                  <div style="width: 54px" v-show="actRe.orundum !== 0">
                    {{ actRe.orundum }}
                  </div>
                  <div style="width: 40px" v-show="actRe.originium !== 0"
                       :class="getSpriteImg('4002icon', 0)"
                  ></div>
                  <div style="width: 54px" v-show="actRe.originium !== 0">
                    {{ actRe.originium }}
                  </div>
                  <div style="width: 40px" v-show="actRe.permit !== 0" :class="getSpriteImg('7003icon', 0)"
                  ></div>
                  <div style="width: 54px" v-show="actRe.permit !== 0">
                    {{ actRe.permit }}
                  </div>
                  <div style="width: 40px" v-show="actRe.permit10 !== 0"
                       :class="getSpriteImg('7004icon', 0)"
                  ></div>
                  <div style="width: 54px" v-show="actRe.permit10 !== 0">
                    {{ actRe.permit10 }}
                  </div>
                </div>
              </el-checkbox-button>
            </div>
          </el-checkbox-group>
          <div v-for="(act, key) in gacha_honeyCake" :key="key">
            <div class="gacha_unit_child" v-show="isDuringDate(act.start,act.end)&&'act'==act.module">
              <div class="gacha_unit_child_title">{{ key }}</div>
              <!-- 一个通用的资源显示模块 -->
              <div class="gacha_resources_unit" style="width: 234px">
                <div style="width: 40px" v-show="act.orundum !== 0" :class="getSpriteImg('4003icon', 0)"></div>
                <div style="width: 54px" v-show="act.orundum !== 0">{{ act.orundum }}</div>
                <div style="width: 40px" v-show="act.originium !== 0" :class="getSpriteImg('4002icon', 0)"></div>
                <div style="width: 54px" v-show="act.originium !== 0">{{ act.originium }}</div>
                <div style="width: 40px" v-show="act.permit !== 0" :class="getSpriteImg('7003icon', 0)"></div>
                <div style="width: 54px" v-show="act.permit !== 0">{{ act.permit }}</div>
                <div style="width: 40px" v-show="act.permit10 !== 0" :class="getSpriteImg('7004icon', 0)"></div>
                <div style="width: 54px" v-show="act.permit10 !== 0">{{ act.permit10 }}</div>
              </div>
            </div>
          </div>
        </div>
      </el-collapse-item>

      <!-- 其它资源（估算） -->
      <el-collapse-item class="collapse-item" name="6" style="display: block">
        <template slot="title">
          <div class="gacha_title_icon"></div>
          <span class="collapse-item_title">其它资源（估算）{{ toFixedByAcc(calResults.gachaTimes_other, 0) }}抽</span>
        </template>

        <div class="gacha_unit" id="otherRes">
          <div v-for="(other, key) in gacha_honeyCake" :key="key">
            <!-- 只显示当前选择的时间段内的奖励&&(公共的奖励||只可当期使用的奖励) -->
            <div class="gacha_unit_child" v-show="isDuringDate(other.start,other.end)&& ('公共' == other.rewardType|| rewardType == other.rewardType) &&'honeyCake'==other.module">
              <div class="gacha_unit_child_title" style="width: 240px">
                {{ key }}
              </div>
              <div class="gacha_resources_unit" style="width: 234px">
                <div style="width: 40px" v-show="other.orundum !== 0" :class="getSpriteImg('4003icon', 0)"></div>
                <div style="width: 54px" v-show="other.orundum !== 0&&key!=='幸运墙'">
                  {{ other.orundum }}
                </div>
                <div style="width: 54px" v-show="other.orundum !== 0&&key==='幸运墙'">
                  {{ other.orundum - poolCountDown * 600 }}
                </div>
                <div style="width: 40px" v-show="other.originium !== 0"
                     :class="getSpriteImg('4002icon', 0)"></div>
                <div style="width: 54px" v-show="other.originium !== 0">
                  {{ other.originium }}
                </div>
                <div style="width: 40px" v-show="other.permit !== 0" :class="getSpriteImg('7003icon', 0)"></div>
                <div style="width: 54px"
                     v-show="other.permit !== 0&&key.indexOf('春节池每日赠送寻访凭证') === -1">
                  {{ other.permit }}
                </div>
                <div style="width: 54px"
                     v-show="other.permit !== 0&&key.indexOf('春节池每日赠送寻访凭证') !== -1">
                  {{ other.permit - poolCountDown }}
                </div>
                <div style="width: 40px" v-show="other.permit10 !== 0"
                     :class="getSpriteImg('7004icon', 0)"></div>
                <div style="width: 54px" v-show="other.permit10 !== 0">
                  {{ other.permit10 }}
                </div>

              </div>
            </div>
          </div>
        </div>
      </el-collapse-item>
      <!-- 致谢 -->
      <el-collapse-item class="collapse-item" name="7" style="display: block">
        <template slot="title">
          <div class="gacha_title_icon" style="background: #337fcb"></div>
          <span class="collapse-item_title">开发信息</span>
        </template>
        <div id="extra" style="max-width: 1080px;margin: auto;">

          <div id="foot_main" style="background: white;">
            <!-- <div id="foot_left"> -->
            <div class="foot_unit">
              <p class="foot_unit_title">-开发信息-</p>
              <a href="https://github.com/Zirun-wang/yituliuFrontEnd">
                <div class="foot_unit_button uni_shadow_2" id="foot_frontEnd">
                  <img class="foot_unit_pic" src="/img/website/github.png"/>
                  前端
                </div>
              </a>
              <a href="https://github.com/yamasakura/yituliuBackEnd">
                <div class="foot_unit_button uni_shadow_2" id="foot_backEnd">
                  <img class="foot_unit_pic" src="/img/website/github.png"/>
                  后端
                </div>
              </a>
              <a href="https://jq.qq.com/?_wv=1027&k=ZmORnr5F">
                <div class="foot_unit_button uni_shadow_2" style="width: 198px;">
                  <img class="foot_unit_pic" src="/img/website/qq.png"/>
                  开发群 938710832
                </div>
              </a>
              <a href="https://shimo.im/sheets/dPkpKP1zQmc1PvqO/7mSBe">
                <div class="foot_unit_button uni_shadow_2" style="width: 198px;">
                  <img class="foot_unit_pic" src="/img/website/图标_源石.png"/>
                  本站财政状况
                </div>
              </a>
            </div>
            <div class="foot_unit">
              <p class="foot_unit_title">-本页开发-</p>
              <a href="https://space.bilibili.com/39109412">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle">
                  <img class="foot_unit_pic" src="https://avatars.githubusercontent.com/u/84258011?v=4">
                  山桜
                </div>
              </a>
              <a href="https://space.bilibili.com/10057492">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle">
                  <img class="foot_unit_pic" src="https://avatars.githubusercontent.com/u/84625349?v=4"/>
                  Zirunwang
                </div>
              </a>  <a href="https://github.com/Yanstory">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle">
                  <img class="foot_unit_pic" src="https://avatars.githubusercontent.com/u/5153875?v=4"/>
                  Yanstory
                </div>
              </a>
              <a href="https://github.com/DSLM">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle">
                  <img class="foot_unit_pic" src="https://avatars.githubusercontent.com/u/12635058?v=4"/>
                  DSLM
                </div>
              </a>
              <a href="https://github.com/ZhaoZuohong">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle">
                  <img class="foot_unit_pic" src="https://avatars.githubusercontent.com/u/34163622?v=4"/>
                  ZhaoZuohong
                </div>
              </a>
            </div>
            <!-- </div> -->
            <!-- <div id="foot_right"> -->
            <div class="foot_unit">
              <p class="foot_unit_title">-数据支持-</p>
              <a href="https://space.bilibili.com/8412516">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle;color:gray;"><img
                  class="foot_unit_pic" src="/img/website/honeycake.webp"/>罗德岛蜜饼工坊
                </div>
              </a>
              <a href="https://prts.wiki/w/%E9%A6%96%E9%A1%B5">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle;color:gray;"><img
                  class="foot_unit_pic" src="/img/website/prts.png"/>PRTS
                </div>
              </a>
              <a href="https://yituliu.site/">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle;color:gray;"><img
                  class="foot_unit_pic" src="/img/website/ico64.png"/>一图流主站
                </div>
              </a>
              <a href="https://space.bilibili.com/22606843">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle;color:gray;"><img
                  class="foot_unit_pic" src="/img/website/公孙长乐.webp"/>公孙长乐
                </div>
              </a>
            </div>
            <div class="foot_unit">
              <p class="foot_unit_title">-B站发布-</p>
              <a href="https://space.bilibili.com/688411531">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle">
                  <img class="foot_unit_pic" src="/img/website/bilibili.png"/>
                  罗德岛基建BETA
                </div>
              </a>
              <p class="foot_unit_title">-粉丝群/反馈-</p>
              <a href="https://jq.qq.com/?_wv=1027&k=q1z3p9Yj">
                <div class="foot_unit_button uni_shadow_2" style="vertical-align:middle">
                  <img class="foot_unit_pic" src="/img/website/qq.png"/>
                  阿戈尔数据文献馆
                </div>
              </a>
            </div>
            <!-- </div> -->
          </div>
          <div style="padding: 8px 16px 8px 16px;max-width: 1080px;margin: auto;">
            本页采用<a href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh">知识共享 署名-非商业性使用
            4.0 国际 许可协议</a>进行许可。转载、公开或以任何形式复制、发行、再传播本页任何内容时，必须注明从明日方舟一图流转载，并提供版权标识、许可协议标识、免责标识和作品链接；且未经许可，不得将本站内容或由其衍生作品用于商业目的。<br>
            本项目为无偿开源项目，致力于方便明日方舟玩家。如有开发/数据分析/设计/美工经验，欢迎来开发群一叙。
          </div>
        </div>
      </el-collapse-item>
    </el-collapse>
    <!-- <foot></foot> -->
  </div>
</template>

<script>
import gacha_potentialJson from "static/json/gacha_potential.json";  //常驻活动和主线数据
import gacha_storePacksJson from "static/json/gacha_storePacks.json";  //商店礼包数据
import gacha_honeyCakeJson from "static/json/gacha_honeyCakeNew.json";  //其他奖励数据
import "~/assets/css/gacha.css";
import toolApi from "@/api/tool";
import cookie from "js-cookie";
// import * as echarts from "echarts";
import echarts from "static/js/echarts.min.js"

export default {
  layout: "defaultGacha",
  head: {
    title: "一图流攒抽计算器 yituliu.site",
    meta: [
      {charset: "utf-8"},
      {
        name: "viewport",
        content:
          "width=device-width, initial-scale=0.68, maximum-scale=0.68, user-scalable=no",
      },
      {
        hid: "description",
        name: "description",
        content: "一图流-感谢庆典攒抽规划",
      },
    ],


    link: [{rel: "icon", type: "image/x-icon", href: "/favicon.ico"}],
  },

  data() {
    return {
      pageTheme: "light",
      itemList: [],
      checkBox: ["0", "1","2", "4", "7"],  //折叠栏绑定数组
      // checkBox: ["1","7"],
      rewardType: '联动限定',  //奖励的类型
      startDate: "", //开始时间
      endDate: "2023/03/21 03:59:00", //结束时间
      start_TimeStamp: "",   //开始时间戳
      end_TimeStamp: "",     //结束时间戳
      timeSelector: "怪猎联动(3.21)",  //活动时间节点选择框的绑定对象
      gacha_potential: gacha_potentialJson, //常驻活动和主线
      gacha_potentialList: [],
      gacha_storePacks: gacha_storePacksJson.data, //商店礼包
      gacha_storePacksList: [],
      gacha_store258: [], //黄票兑换38抽
      gacha_store258List: [],
      gacha_honeyCake: gacha_honeyCakeJson, //其他奖励数据
      gacha_actReList: [],

      originium: 0, //源石
      orundum: 0, //合成玉
      permit: 0, //寻访
      permit10: 0, //十连寻访
      sellsCount: 0, //总氪金总和
      gachaTimes_total: 0, //总抽卡次数


      calResults: {},   //攒抽计算的各种结果

      paradox: 0,  //悖论模拟
      annihilation: 0, //未通过剿灭个数
      orundum_ap: 0,  //用于搓玉的理智数量
      orundum_rate: 1.09, //搓玉系数

      remainingDays: 0, //剩余天数
      remainingWeeks: 0, //剩余周数
      remainingMonths: 0, //剩余月数
      remainingCheckinTimes: 0, // 剩余签到次数

      originium_648: 0, //普通源石648
      originium_328: 0, //普通源石328
      originium_198: 0, //普通源石198
      originium_98: 0, //普通源石98
      originium_30: 0, //普通源石30
      originium_6: 0, //普通源石6
      poolCountDown: 0, //限定池每日送抽倒计时
      poolCountDownFlag_permit: true, //限定池每日送抽倒计时
      poolCountDownFlag_orundum: true, //限定池每日送抽倒计时

      dailyRewards: 100, //每日奖励
      weeklyTaskRewards: 500, //周常奖励
      annihilationRewards: 1800, //剿灭奖励
      originiumFlag: true, //是否源石抽卡
      annihilationFlag: true, //是否完成剿灭
      weeklyTaskFlag: true, //是否完成周常
      storeFlag: false, //是否兑换绿票商店
      annihilationValue: true,   //当周的剿灭合成玉奖励
      weeklyTaskValue: true,   //当周的周常合成玉奖励
      storeValue: 0,  //绿票商店抽数
      skinNumValue: 0,   //皮肤消耗源石数量
      customValue: 0, //自定义值
      cookieInit: 0,   //cookie是否获取标志
      pieData: [],

    };
  },
  created() {
    this.TimeStampFormat();
    this.getDate();
    // this.getInterval();
    // this.getEveryreWard();
    // this.getPoolCountDown();
    this.checkEndDate();

  },
  mounted() {
    this.pieChart(this.pieData);
    this.openNotification();
  },
  methods: {

    updateVisits() {
      toolApi.updateVisits("gacha").then((response) => {
      });
    },

    //公告通知
    openNotification() {
      this.$notify({
        title: '更新公告',
        dangerouslyUseHTMLString: true,
        // message: '<strong> 限定池还有'+ this.poolCountDown + '天,结束</strong>',
        message: '<strong> 新增 剿灭战模拟战计算<br>调整搓玉计算模块<br>因为鹰角自由的发饼更新了自由的联动日期</strong>',
        duration: 12000
      });
    },

    TimeStampFormat(){
      Object.entries(this.gacha_honeyCake).forEach(list=>{
         list[1].start = Date.parse(new Date(list[1].start));
         list[1].end = Date.parse(new Date(list[1].end));
      })
    },

    // 选择攒计算的时间节点
    checkEndDate() {
      // this.cookieInit=true;
      console.log(this.timeSelector)
      if (this.timeSelector === '怪猎联动(3.21)') {
        this.endDate = '2023/03/21 03:59:00';
        this.rewardType = "联动限定";   //这里是切换奖励类型，具体看下面的注释，搜索 奖励类型
        this.poolCountDownFlag_permit = false;  //是否要计算限定池倒计时（主要用于计算每日赠送合成玉和单抽）
        this.poolCountDownFlag_orundum = false;  //是否要计算限定池倒计时（主要用于计算每日赠送合成玉和单抽）
        this.gacha_store258List = [];
      } else if (this.timeSelector === '4周年(5.15)') {
        this.endDate = "2023/05/15 03:59:00";
        this.rewardType = "周年限定";
        this.poolCountDownFlag_permit = false;
        this.poolCountDownFlag_orundum = true;  
      }


      this.getInterval();
      this.getEveryreWard();
      this.getPoolCountDown();
      this.setGacha_store258();
      this.compute();

    },

    toFixedByAcc(num, acc) {
      acc = (typeof acc !== 'undefined') ? acc : 2;
      return parseFloat(num).toFixed(acc);
    },

    //获取雪碧图
    getSpriteImg(packName, index) {
      if (index === 0) return "bg-" + packName + " sprite_gacha";
      return "bg-" + packName;
    },

    //判断奖励是否在时间段内
    isDuringDate(start, end) {
      // console.log(Date.parse(new Date(start))>=this.start_TimeStamp ||Date.parse(new Date(end))<=this.end_TimeStamp)
      if (start >= this.start_TimeStamp && end <= this.end_TimeStamp) return true;
      return false;

    },
    //获取当天日期
    getDate() {
      var date = new Date();
      var y = date.getFullYear(); //年
      var m = (date.getMonth() + 1).toString().padStart(2, "0"); //月
      var d = date.getDate().toString().padStart(2, "0"); //日
      var h = date.getHours().toString().padStart(2, "0"); //时
      var mm = date.getMinutes().toString().padStart(2, "0"); //分
      var s = date.getSeconds().toString().padStart(2, "0"); //秒
      this.startDate = `${y}/${m}/${d} ${h}:${mm}:${s}`;
    },

    //获取限定池和红包倒计时
    getPoolCountDown() {
      var num = parseInt((this.end_TimeStamp - this.start_TimeStamp) / 86400000); //计算距离限定池还有多少天
      if (num < 14) {  //少于14天扣除每日赠送抽卡资源
        this.poolCountDown = 14 - num;
      }
      console.log("限定池还有" + this.poolCountDown + "天,结束");
    },

    //获取还有多少天
    getInterval() {
      console.log("今天是", this.startDate);
      this.remainingWeeks = 0;  //剩余周数
      this.remainingCheckinTimes = 0;  //剩余签到次数
      this.remainingMonths = 1;  //剩余月数
      this.start_TimeStamp = Date.parse(new Date(this.startDate)); //今日日期的时间戳
      this.end_TimeStamp = Date.parse(this.endDate); //结束日期的时间戳
      var timeInterval = parseInt((this.end_TimeStamp - this.start_TimeStamp) / 86400000);  //计算剩余天数

      let month = new Date(this.startDate).getMonth();

      for (let i = 1; i < timeInterval + 1; i++) {
        var date = new Date(this.start_TimeStamp + 86400000 * i);
        if (date.getDay() === 1) this.remainingWeeks++;  //判断接下来还有多少个星期一
        if (date.getDate() === 17) this.remainingCheckinTimes++; //判断接下来还有17号，17号签到有抽卡券
        if (month != new Date(date).getMonth()) {          // 通过保存的月份!=当前获取的月份，判断是否到了下个月，是则月数+1
          month = new Date(date).getMonth();
          this.remainingMonths++;
        }
      }
      this.remainingDays = timeInterval;    //赋值剩余天数
      console.log("距离活动还有：", this.remainingMonths + "月，", this.remainingWeeks + "周，", this.remainingDays + "天");
    },

    // 设置258黄票商店兑换抽卡券
    setGacha_store258() {
      var m = new Date().getMonth() + 1; //月
      this.gacha_store258 = [];
      for (var i = 0; i < this.remainingMonths; i++) {
        this.gacha_store258.push({
          "packName": m + "月黄票换抽",
          "packPrice": "0",
          "gachaOriginium": "0",
          "gachaOrundum": "0",
          "gachaPermit": "8",
          "gachaPermit10": "3",
          "price": "0.00",
          "packType": "store"
        });
        m++;
        m = (m - 1) % 12 + 1;
      }
    },

    //  计算日常奖励
    getEveryreWard() {
      this.dailyRewards = 100 * this.remainingDays;
      this.weeklyTaskRewards = 500 * this.remainingWeeks;
      this.annihilationRewards = 1800 * this.remainingWeeks;
    },

    compute() {
      //初始化各种对象
      this.valueInit();

      //判断是否用源石抽卡
      var flag_originium = 0;
      if (this.originiumFlag) {
        flag_originium = 1;
      }

      //判断是否完成周常日常
      this.weeklyTaskValue = 1;
      if (this.weeklyTaskFlag) {
        this.weeklyTaskValue = 0;
      }

      //判断是否完成剿灭
      this.annihilationValue = 1;
      if (this.annihilationFlag) {
        this.annihilationValue = 0;
      }


      this.storeValue = 0;
      // 这个值可能是从cookie拿到,要转换一下类型
      if (typeof this.storeFlag === 'string') {
        if (this.storeFlag === "false") this.storeFlag = false;
        if (this.storeFlag === "true") this.storeFlag = true;

      }

      //判断是否兑换完本月绿票商店
      if (this.storeFlag) {
        this.storeValue = 1;
      }


      //  计算自定义合成玉和搓玉
      let custom_exist = this.customValue + this.orundum_ap * this.orundum_rate

      //库存抽卡次数（单项）
      this.calResults.gachaTimes_exist =
        this.calResults.originium_exist * 0.3 * flag_originium +
        this.calResults.orundum_exist / 600 + custom_exist / 600+
      this.calResults.permit_exist +
      this.calResults.permit10_exist * 10;


      //xxxx_daily格式的属性   日常奖励的各项奖励数量，下同
      this.calResults.orundum_daily +=
        parseInt(this.dailyRewards) +   //日常奖励
        parseInt(this.weeklyTaskRewards) +  //周常奖励
        parseInt(this.annihilationRewards) +   //剿灭奖励
        parseInt(this.remainingMonths - this.storeValue) * 600 +  //绿票商店合成玉
        this.weeklyTaskValue * 500 +  //当周周常是否已经完成
        this.annihilationValue * 1800; //当周剿灭是否已经完成


      this.calResults.permit_daily +=
        parseInt(this.remainingMonths - this.storeValue) * 4 +   //绿票商店凭证
        parseInt(this.remainingCheckinTimes);   //每月签到

      //黄票商店38抽计算
      for (let i = 0; i < this.gacha_store258List.length; i++) {
        this.calResults.permit_daily += parseInt(this.gacha_store258[this.gacha_store258List[i]].gachaPermit);
        this.calResults.permit10_daily += parseInt(this.gacha_store258[this.gacha_store258List[i]].gachaPermit10);
      }


      //gachaTimes_daily    日常奖励的抽卡次数
      this.calResults.gachaTimes_daily =
        parseInt(this.calResults.originium_daily) * 0.3 * parseInt(flag_originium) +
        parseInt(this.calResults.orundum_daily) / 600 +
        parseInt(this.calResults.permit_daily) +
        parseInt(this.calResults.permit10_daily) * 10;


      //主线和常驻活动计算（共计）
      this.gacha_potentialList.forEach(index => {
        this.calResults.originium_potential += parseInt(this.gacha_potential[index].gachaOriginium);
        this.calResults.orundum_potential += parseInt(this.gacha_potential[index].gachaOrundum);
      })


      //悖论模拟
      this.calResults.orundum_potential += parseInt(this.paradox) * 200 + this.annihilation * 1500;

      //主线和常驻活动抽卡次数（单项）
      this.calResults.gachaTimes_potential =
        this.calResults.originium_potential * 0.3 * flag_originium +
        this.calResults.orundum_potential / 600;

      // index是被选中的商店礼包json的索引
      this.gacha_storePacksList.forEach(index => {
        //月卡单独判断
        if ("月卡" === this.gacha_storePacks[index].packName) {  // console.log("买的月卡个数", Math.ceil(this.remainingDays / 30));
          this.gacha_storePacks[index].gachaOrundum = parseInt(this.remainingDays) * 200;   //重新给商店礼包json的月卡的相关属性赋值
          this.gacha_storePacks[index].gachaOriginium = Math.ceil(this.remainingDays / 30) * 6; //重新给商店礼包json的月卡的相关属性赋值

          this.sellsCount += Math.ceil(this.remainingDays / 30) * 30;  //计算售价
          this.calResults.orundum_gacha += parseInt(this.remainingDays) * 200;  //根据天数计算月卡的合成玉
          this.calResults.originium_gacha += Math.ceil(this.remainingDays / 30) * 6; //根据天数/30 计算月卡的源石
        } else {
          this.sellsCount += parseInt(this.gacha_storePacks[index].packPrice); //计算售价
          this.calResults.orundum_gacha += parseInt(this.gacha_storePacks[index].gachaOrundum);
          this.calResults.originium_gacha += parseInt(this.gacha_storePacks[index].gachaOriginium);
        }
        this.calResults.permit_gacha += parseInt(this.gacha_storePacks[index].gachaPermit);
        this.calResults.permit10_gacha += parseInt(this.gacha_storePacks[index].gachaPermit10);
      })


      //普通源石购买数量
      this.calResults.originium_gacha +=
        this.originium_648 * 185 +
        this.originium_328 * 90 +
        this.originium_198 * 50 +
        this.originium_98 * 24 +
        this.originium_30 * 7 +
        this.originium_6;

      //氪金项目抽卡次数（单项）
      this.calResults.gachaTimes_gacha =
        this.calResults.originium_gacha * 0.3 * flag_originium +
        this.calResults.orundum_gacha / 600 +
        this.calResults.permit_gacha +
        this.calResults.permit10_gacha * 10;

      // 计算购买的普通源石的价格
      this.sellsCount +=
        648 * this.originium_648 +
        328 * this.originium_328 +
        198 * this.originium_198 +
        98 * this.originium_98 +
        30 * this.originium_30 +
        6 * this.originium_6;

      /*
      gacha_honeyCake的数据格式是
            {"奖励名称":{
                    "originium": 1,   源石
                    "orundum": 200,      合成玉
                    "permit": 0,    单抽
                    "permit10": 0,   十连
                    "start": "2023/03/07 16:00:00",      开始时间(暂时无用)
                    "end": "2023/03/21 03:59:00",        结束时间
                    "rewardType": "公共",             奖励类型  一般为公共，但是有些奖励是只有当期活动才能使用
                    "module": "honeyCake"        判断奖励是哪个模块,
               }
            }*/

      Object.entries(this.gacha_honeyCake)      //转为一个list<list>   结构为[[奖励名称,奖励内容],[奖励名称,奖励内容]]
        .filter((list) => this.isDuringDate(list[1].start, list[1].end) && ("公共" == list[1].rewardType || this.rewardType == list[1].rewardType))    //只计算当前选择的时间段内的奖励&&(公共的奖励||只可当期使用的奖励)
        .forEach(list => {                                             //循环list<list>， list为[奖励名称,奖励内容]
          if ('honeyCake' === list[1].module) {    //这里是计算其他奖励
            this.calResults.originium_other += list[1].originium;  //xxxxx_other格式的属性  其他奖励的的各项奖励数量，下同
            this.calResults.orundum_other += list[1].orundum;
            this.calResults.permit_other += list[1].permit;
            this.calResults.permit10_other += list[1].permit10;
            // console.log(list[0])
          } else if ('act' === list[1].module) {        //这里是计算活动奖励
            this.calResults.originium_act += list[1].originium;     //xxxx_act格式的属性 活动奖励的各项奖励数量，下同
            this.calResults.orundum_act += list[1].orundum;
            this.calResults.permit_act += list[1].permit;
            this.calResults.permit10_act += list[1].permit10;
          }
        })

      this.gacha_actReList.forEach(key => {  //循环UI上绑定的复刻多选框的选项集合，集合内为[奖励名称,奖励名称,奖励名称], key为奖励名称
        //这里是计算活动复刻奖励,通过key获得gacha_honeyCake内的奖励内容
        this.calResults.originium_act += this.gacha_honeyCake[key].originium;
        this.calResults.orundum_act += this.gacha_honeyCake[key].orundum;
        this.calResults.permit_act += this.gacha_honeyCake[key].permit;
        this.calResults.permit10_act += this.gacha_honeyCake[key].permit10;
      });

      this.calResults.gachaTimes_act =
        parseInt(this.calResults.originium_act) * 0.3 * parseInt(flag_originium) +
        parseInt(this.calResults.orundum_act) / 600 +
        parseInt(this.calResults.permit_act) +
        parseInt(this.calResults.permit10_act) * 10;


      //自动扣除部分 ↓
      //减去红包墙/矿区已经赠送过的合成玉
      if (this.poolCountDownFlag_orundum) this.calResults.orundum_other -= parseInt(this.poolCountDown) * 600;

      //减去限定池已经赠送过的单抽
      if (this.poolCountDownFlag_permit) this.calResults.permit_other -= parseInt(this.poolCountDown);


      //其他抽卡次数
      this.calResults.gachaTimes_other =
        parseInt(this.calResults.originium_other) * 0.3 * parseInt(flag_originium) +
        parseInt(this.calResults.orundum_other) / 600 +
        parseInt(this.calResults.permit_other) +
        parseInt(this.calResults.permit10_other) * 10


      // 所有模块相加-源石
      this.originium += this.calResults.originium_other + this.calResults.originium_act + this.calResults.originium_potential +
        this.calResults.originium_daily + this.calResults.originium_exist + this.calResults.originium_gacha;
      // 所有模块相加-合成玉
      this.orundum += this.calResults.orundum_other + this.calResults.orundum_act + this.calResults.orundum_potential +
        this.calResults.orundum_daily + this.calResults.orundum_exist + this.calResults.orundum_gacha
        + custom_exist;
      // 所有模块相加-单抽
      this.permit += this.calResults.permit_other + this.calResults.permit_act + this.calResults.permit_potential +
        this.calResults.permit_daily + this.calResults.permit_exist + this.calResults.permit_gacha;
      // 所有模块相加-十连
      this.permit10 += this.calResults.permit10_other + this.calResults.permit10_act + this.calResults.permit10_potential +
        this.calResults.permit10_daily + this.calResults.permit10_exist + this.calResults.permit10_gacha;


      //计算皮肤消耗
      if (parseInt(this.originium - parseInt(this.skinNumValue) * 18) < 0) this.$message.error("源石不足");
      this.originium = parseInt(this.originium) - parseInt(this.skinNumValue) * 18;
      this.originium = parseInt(this.originium) * parseInt(flag_originium);

      //源石抽卡次数
      this.gachaTimes_originium = this.originium * 0.3 * parseInt(flag_originium);

      //总抽卡次数
      this.gachaTimes_total =
        parseInt(this.originium) * 0.3 * parseInt(flag_originium) +
        parseInt(this.orundum) / 600 +
        parseInt(this.permit) +
        parseInt(this.permit10) * 10;


      // 设置饼图的数据内容
      this.pieData = [];
      this.setPieData(this.calResults.gachaTimes_exist, "现有");
      this.setPieData(this.calResults.gachaTimes_potential, "潜在");
      this.setPieData(this.calResults.gachaTimes_daily, "日常");
      this.setPieData(this.calResults.gachaTimes_gacha, "氪金");
      this.setPieData(this.calResults.gachaTimes_act, "活动");
      this.setPieData(this.calResults.gachaTimes_other, "其它");
      // console.log(this.calResults);
      if (this.cookieInit > 1) {
        this.pieChart(this.pieData);
      }
    },


    setPieData(gachaTimes, describption) {
      let chartFan = {};
      if (gachaTimes > 0) {
        chartFan.value = parseInt(gachaTimes);
        chartFan.name = describption;
        this.pieData.push(chartFan);
      }

    },

    //初始化信息
    valueInit() {

      //首次打开页面读取cookie
      if (this.cookieInit === 0) {
        this.calResults.originium_exist = cookie.get("originium_exist");
        this.calResults.orundum_exist = cookie.get("orundum_exist");
        this.calResults.permit_exist = cookie.get("permit_exist");
        this.calResults.permit10_exist = cookie.get("permit10_exist");
        this.paradox = cookie.get("paradox");
        this.annihilation = cookie.get("annihilation");
        this.storeFlag = cookie.get("storeFlag");
      }

      // console.log(this.calResults.originium_exist ===undefined||this.calResults.originium_exist == "undefined");

      //没有cookie记录值强制赋值0
      if (this.calResults.originium_exist == "" || this.calResults.originium_exist === undefined || this.calResults.originium_exist == "undefined") this.calResults.originium_exist = 0;
      if (this.calResults.orundum_exist == "" || this.calResults.orundum_exist === undefined || this.calResults.orundum_exist == "undefined") this.calResults.orundum_exist = 0;
      if (this.calResults.permit_exist == "" || this.calResults.permit_exist === undefined || this.calResults.permit_exist == "undefined") this.calResults.permit_exist = 0;
      if (this.calResults.permit10_exist == "" || this.calResults.permit10_exist === undefined || this.calResults.permit10_exist == "undefined") this.calResults.permit10_exist = 0;
      if (this.paradox == "" || this.paradox === undefined || this.paradox == "undefined") this.paradox = 0;
      if (this.annihilation == "" || this.annihilation === undefined || this.annihilation == "undefined") this.annihilation = 0;
      if (this.storeFlag === undefined || this.storeFlag == "undefined") this.storeFlag = true;

      //保存cookie
      cookie.set("originium_exist", this.calResults.originium_exist, {expires: 30});
      cookie.set("orundum_exist", this.calResults.orundum_exist, {expires: 30});
      cookie.set("permit_exist", this.calResults.permit_exist, {expires: 30});
      cookie.set("permit10_exist", this.calResults.permit10_exist, {expires: 30});
      cookie.set("paradox", this.paradox, {expires: 30});
      cookie.set("annihilation", this.annihilation, {expires: 30});
      cookie.set("storeFlag", this.storeFlag, {expires: 30});


      this.cookieInit++;

      if (this.originium_648 === "") this.originium_648 = 0;
      if (this.originium_328 === "") this.originium_328 = 0;
      if (this.originium_198 === "") this.originium_198 = 0;
      if (this.originium_98 === "") this.originium_98 = 0;
      if (this.originium_30 === "") this.originium_30 = 0;
      if (this.originium_6 === "") this.originium_6 = 0;
      if (this.customValue === "") this.customValue = 0;
      if (this.orundum_ap === "") this.orundum_ap = 0;
      if (this.orundum_rate === "") this.orundum_rate = 0;

      this.paradox = parseInt(this.paradox);
      this.annihilation = parseInt(this.annihilation);
      this.originium_648 = parseInt(this.originium_648);
      this.originium_328 = parseInt(this.originium_328);
      this.originium_198 = parseInt(this.originium_198);
      this.originium_98 = parseInt(this.originium_98);
      this.originium_30 = parseInt(this.originium_30);
      this.originium_6 = parseInt(this.originium_6);
      this.customValue = parseInt(this.customValue);
      this.orundum_ap = parseInt(this.orundum_ap);
      this.orundum_rate = parseFloat(this.orundum_rate);

      this.calResults.originium_exist = parseInt(this.calResults.originium_exist);
      this.calResults.orundum_exist = parseInt(this.calResults.orundum_exist);
      this.calResults.permit_exist = parseInt(this.calResults.permit_exist);
      this.calResults.permit10_exist = parseInt(this.calResults.permit10_exist);

      this.originium = 0;
      this.orundum = 0;
      this.permit = 0;
      this.permit10 = 0;
      this.sellsCount = 0;

      this.calResults.originium_potential = 0;
      this.calResults.orundum_potential = 0;
      this.calResults.permit_potential = 0;
      this.calResults.permit10_potential = 0;

      this.calResults.originium_daily = 0;
      this.calResults.orundum_daily = 0;
      this.calResults.permit_daily = 0;
      this.calResults.permit10_daily = 0;

      this.calResults.originium_gacha = 0;
      this.calResults.orundum_gacha = 0;
      this.calResults.permit_gacha = 0;
      this.calResults.permit10_gacha = 0;

      this.calResults.originium_act = 0;
      this.calResults.orundum_act = 0;
      this.calResults.permit_act = 0;
      this.calResults.permit10_act = 0;

      this.calResults.originium_other = 0;
      this.calResults.orundum_other = 0;
      this.calResults.permit_other = 0;
      this.calResults.permit10_other = 0;
    },

    getChapterWidth(index) {
      if (index % 2 === 0) return "width:200px;";
      else return "width:60px;";
    },

    getPprLabel(ppr) {
      if (ppr < 7.5) return "gacha_packPpr_t1"
      if (ppr < 11.7) return "gacha_packPpr_t2"
      return "gacha_packPpr_t3"
    },


    getInteger(num) {
      return parseInt(parseInt(num / 100) * 100);
    },

    getTitleWord(index) {
      for (let i in this.checkBox) {
        if (index === this.checkBox[i]) {
          return "收起";
        }
      }
      return "展开";
    },

    pieChart(data) {
      let chartDom = document.getElementById("gacha_total_pie");
      let myChart = echarts.init(chartDom);

      let option = {
        tooltip: {
          formatter: "{a} {b} : {c}抽,占 ({d}%)",
          position: "inner",
        },

        series: [
          {
            name: "攒抽占比",
            type: "pie",
            radius: "70%",
            center: ["50%", "50%"],
            itemStyle: {
              normal: {
                label: {
                  show: true,
                  textStyle: {color: "#000000", fontSize: "16"},
                  formatter: function (val) {
                    //让series 中的文字进行换行
                    return val.name.split("-").join("\n");
                  },
                },
                labelLine: {
                  show: true,
                  lineStyle: {color: "#000000"},
                }, //线条颜色
              }, //基本样式
              emphasis: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: "rgba(0, 0, 0, 0.5)", //鼠标放在区域边框颜色
                textColor: "#000",
              }, //鼠标放在各个区域的样式
            },
            data: data,
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: "rgba(0, 0, 0, 0.5)",
              },
            },
          },
        ],
      };
      myChart.setOption(option);
    },

    handleChange(val) {
      // console.log(val);
    },
  },
};
</script>


<style scoped>

.foot_unit {
  font-size: 16px;
}

.foot_unit_title {
  margin: 4px 0px;
}

.el-collapse-item {
  color: #222222;
  margin: 12px;
  background-color: #d8d8d8;
  border-radius: 8px;
  font-size: 20px;
  box-shadow: 0px 2px 6px #a0a0a0b0;
  overflow: hidden;
}

.collapse-item_title {
  font-size: 24px;
  padding: 8px 0px;
  font-weight: 600;
}

.el-collapse-item__wrap {
  margin: 6px;
  margin-left: 8px;
  vertical-align: middle;
  display: inline-block;
  will-change: height;
  border-bottom: 0px;
  background-color: #d8d8d8;
}

.el-collapse-item__content {
  padding-bottom: 0px;
}

.el-collapse-item__header {
  background-color: #d8d8d8;
}

.el-divider--horizontal {
  margin: 2px 6px;
  width: calc(100% - 12px);

}

/* .el-switch__core{
    position: static;
      } */

@media (min-width: 1080px) and (orientation: landscape) {
  #totalTable {
    position: absolute ! important;
    top: 0 ! important;
    left: 0;
    width: 540px;
  }

  .el-collapse {
    padding-left: 550px;
    height: 100%;
    overflow-y: scroll;
  }

  #gacha {
    max-width: 1200px;
    height: calc(100vh - 85px);
    scrollbar-width: none;
    /* firefox */
    -ms-overflow-style: none;
  }

  #gacha::-webkit-scrollbar {
    width: 0 !important
  }
}
</style>
